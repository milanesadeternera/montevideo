//Mostrar modal de bienvenida
$(window).on('load', function(){ 
    let botonModal = document.getElementById("botonModal");
    botonModal.style.display = "";
    let botonCarga =  document.getElementById("botonCarga");
    botonCarga.style.display = "none";
});

//Mostrar Navbar
function DisplayNav(){
    //Tengo un bug ac√° que arreglar, el modal tiene display block, hay que mejorar eso.
    let wmodal =  document.getElementById("welcomeModal");
    wmodal.style.display = "";
    $("#welcomeModal").modal('hide');
    var nav = document.getElementById("navbarControl");
    nav.style.display = "block";
}

const basemap = new ol.layer.Tile({
    name: 'Mapa base',
    source: new ol.source.OSM()
});

var imageGroup = new ol.layer.Group({
    name: "imageGroup",
	layers: []
});

const map = new ol.Map({
    target: 'map',
    layers: [basemap,imageGroup],
    view: new ol.View({
        center: ol.proj.fromLonLat([-56.19138971919159, -34.90553615890344]),
        zoom: 18
    }),
    controls: []
});

function getPlannerGroup() {
    var layers = map.getLayers();
    var length = layers.getLength(), l;
    for (var i = 0; i < length; i++) {
        l = layers.item(i);
        var lt = l.get('name');
        // check for layers within groups
        if (lt === 'imageGroup') { 
                if (l.getLayers) {
                var innerLayers = l.getLayers().getArray();
                return innerLayers;
                }
        }
    }
}

var collection = getPlannerGroup();

//Cargamos los mapas
//Name, ImageCenter, ImageScale, ImageRotate
var imagelayers = [
    ['I02490_0.jpg',[-6254307.86502856,-4149725.972923328],[0.5230681129713599,0.5230681129717291],0.739423894308572],
    ['I02490_1.jpg',[-6252965.998101763,-4150973.759549226],[0.5246763947163444,0.5163976297185607],0.748274502733731],
    ['I02490_5.jpg',[-6253669.65458482, -4151744.579291365],[0.5208371727735598,0.5208371727735598],0.7473738911509005],
    ['I02490_4.jpg',[-6255021.466263206,-4150492.319490679],[0.5215510554842502,0.5215510554842502],0.7430766939572445],
    ['I02490_6.jpg',[-6252319.615907142, -4152988.325786604],[0.5274301449010714,0.5274301449010714],0.7459170082781171],
    ['I02490_2.jpg',[-6251610.921709742,-4152224.348409382],[0.526718407713491,0.526718407713491],0.7442506878266586],
    ['I02492_5.jpg',[-6250806.410075606, -4148813.4034407055],[0.5251156880456054,0.5251156880456054],0.74452272817587],
    ['I02490_8.jpg',[-6255796.977530287,-4151359.8521119044],[0.5226634532675771,0.5226634532675771],0.7436061706597119],
    ['I02490_9.jpg',[-6254446.602750643,-4152616.2970671947],[0.5344304861288662,0.5344304861288662],0.738827675754846],
    ['I02490_12.jpg',[-6256575.043173518,-4152209.8284186013],[0.5096053227434465,0.5096053227434465],0.7343836600039562],
    ['I02492_13.jpg',[-6252291.463338181,-4150423.513104556],[0.5220816664784875,0.5191379830056501],0.7542814299188296],
    ['I02492_0.jpg',[-6251310.808875083, -4146765.9600473833],[0.5146433226711624,0.5146433226711624],0.7458734638003326],
    ['I02492_1.jpg',[-6250028.670041323, -4147961.377979194],[0.5242339066452811,0.5242339066452811],0.7455289966374092],
    ['I02492_2.jpg',[-6248740.491914502,-4149161.3635762515],[0.53009583641014,0.53009583641014],0.7455571815318704],
    ['I02492_3.jpg',[-6247438.612346894, -4150365.384161363],[0.5192800672120396,0.5192800672120396],0.747674667932154],
    ['I02492_4.jpg',[-6252089.898270803,-4147636.2404078287],[0.5223341565139266,0.5035759231469599],0.716697391493847],
    ['I02492_6.jpg',[-6249513.231978729, -4150017.9388491856],[0.519472900251822,0.519472900251822],0.7525691209094718],
    ['I02492_7.jpg',[-6248242.135390494, -4151207.5072195013],[0.5150339962937304,0.5150339962937304],0.7538083051431453],
    ['I02492_8.jpg',[-6252876.747729207, -4148461.6728138444],[0.5188426333526823,0.5188426333526823],0.7461113279768369],
    ['I02492_9.jpg',[-6251583.051799553, -4149655.0152458698],[0.5179268985088162,0.5179268985088162],0.7468273636287169],
    ['I02492_10.jpg',[-6250295.430588123, -4150854.109313653],[0.5213365425023326,0.5213365425023326],0.7531482116236533],
    ['I02492_12.jpg',[-6253576.057118534,-4149228.1885792785],[0.5245422878474028,0.5245422878474028],0.7421612631528655,],
    ['I02492_14.jpg',[-6250990.806665805,-4151621.8235568614],[0.5177981644413585,0.5177981644413585],0.7534916817959394],
    ['I02492_15.jpg',[-6249705.446377099, -4152897.3078622324],[0.5543278428224854,0.5543278428224854],0.7092438344778622],
    ['I02488_9.jpg',[-6256712.478284896, -4144848.9746748093],[0.5225424014666776,0.5225424014666776],0.7484689426457678],
    ['I02488_13.jpg',[-6257418.935101423,-4145611.556372186],[0.522560467707882,0.522560467707882],0.7523234185997787],
    ['I02488_5.jpg',[-6255920.822033205, -4144000.001779852],[0.5254514734619214,0.5254514734619214],0.7559907869917196],
    ['I02488_6.jpg',[-6254574.980609731, -4145277.0037034983],[0.523863595216935,0.523863595216935],0.7554959036659533],
    ['I02488_10.jpg',[-6255362.428357073, -4146118.4510759693],[0.5173676370387322,0.5192819848173462],0.7567386281611019],
    ['I02488_0.jpg',[-6256470.525208856, -4141889.3796055913],[0.5247016009347262,0.5247016009347262],0.7582828470926181],
    ['I02488_4.jpg',[-6257267.138193677, -4142729.0340637923],[0.5230827920810343,0.5230827920810343],0.7640186113326475],
    ['I02488_7.jpg',[-6253237.37664123, -4146541.5343794054],[0.5182861426396588,0.5182861426396588],0.748836031374498],
    ['I02488_8.jpg',[-6258059.988786539, -4143571.2595845093],[0.5248288032673732,0.5248288032673732],0.7559563067699824],
    ['I02488_1.jpg',[-6255121.428867133, -4143162.3846616517],[0.516402450738516,0.516402450738516],0.761638319790275],
    ['I02488_2.jpg',[-6253781.599995, -4144439.898384111],[0.5257862173933778,0.5257862173933778],0.7555681555988386],
    ['I02488_3.jpg',[-6252438.609601308, -4145708.6983609046],[0.5169170632577292,0.5169170632577292],0.764496531006104],
    ['I02488_11.jpg',[-6254022.744323976, -4147386.377851975],[0.5226913793564076,0.5226913793564076],0.7609801540030678],
    ['I02488_12.jpg',[-6258777.994606368,-4144346.4243282024],[0.5308654502307474,0.5308654502307474],0.7504996677973527],
    ['I02488_14.jpg',[-6256076.119541868,-4146871.844248928],[0.5216671589339508,0.5216671589341856],0.7532372364490278],
    ['I02488_15.jpg',[-6254743.644579813,-4148141.968091562],[0.5269555031230789,0.5269555031230789],0.7617467420892909]
];

for(let layerIndex = 0; layerIndex < imagelayers.length ; layerIndex++){
    let layer = new ol.layer.GeoImage({
        name: imagelayers[layerIndex][0],
        source: new ol.source.GeoImage({
            url: "./maplayers/"+imagelayers[layerIndex][0],
                "imageCenter": imagelayers[layerIndex][1],
                "imageScale": imagelayers[layerIndex][2],
                "imageRotate": imagelayers[layerIndex][3],
                projection: 'EPSG:3857'
                })
    });
    console.log("Fin "+imagelayers[layerIndex][0]+" "+layerIndex+" de "+imagelayers.length)
    collection.push(layer);
    map.render();
}

var layerSwitcher = new ol.control.LayerSwitcher({ 
  tipLabel: 'Leyenda' 
});

const opacityInput = document.getElementById('opacity-input');
function update() {
    const opacity = parseFloat(opacityInput.value);
    imageGroup.setOpacity(opacity);
  }
opacityInput.addEventListener('input', update);
update();

//map.addControl(layerSwitcher);
//layerSwitcher.showPanel();
